# actionable-notifications-subflow-for-ios
Actionable Notifications Node-Red Subflow for Home Assistant Companion - iOS

This was originally a gist [link](https://gist.github.com/sstratoti/8021c5a4ee8e34313c3f59ba20c4a83a) but I felt that a true github project would help with those that would like to submit issues, questions or pull requests. This way we can manage the code all in one place and people can follow it for updates.

This is a subflow I created that is based originally on the [actionable-notifications-subflow-for-android](https://zachowj.github.io/node-red-contrib-home-assistant-websocket/cookbook/actionable-notifications-subflow-for-android.html) that is in the Home Assistant Node-Red cookbook.

| Options        | Description                                                                                            |                                                             Documentation                                                             |
| -------------- | ------------------------------------------------------------------------------------------------------ | :-----------------------------------------------------------------------------------------------------------------------------------: |
| Group Name                                                                    | You can edit this in the subflow directly and add in the values for your groups. Grouping combines notifications together visually.                                                                                                                                                                      | [link](https://companion.home-assistant.io/docs/notifications/notifications-basic/#grouping)                              |
| Tag (for replacing messages - optional)                                       | Replace an existing notification by using a tag for the notification. All subsequent notifications will take the place of a notification with the same tag. If a tag is not provided, one will be auto-generated.                                                                                        | [link](https://companion.home-assistant.io/docs/notifications/notifications-basic/#replacing)                             |
| Notify Service                                                                | Can take multiple services as a comma delimited list e.g.: `mobile_app_username, mobile_app_username2`                                                                                                                                                                                                   |                                                                                                                   |
| Title                                                                         | Top line of text                                                                                                                                                                                                                                                                                         | [link](https://companion.home-assistant.io/docs/notifications/notifications-basic)                                        |
| Subtitle (optional)                                                           | Second line of text                                                                                                                                                                                                                                                                                      | [link](https://companion.home-assistant.io/docs/notifications/notifications-basic/#subtitle--subject)                     |
| Message                                                                       | Message Text                                                                                                                                                                                                                                                                                             |                                                                                                                   |
| Notification URL (optional)                                                   | lovelace dashboard, https:// or app://.                                                                                                                                                                                                                                                                  | [link](https://companion.home-assistant.io/docs/notifications/notifications-basic#opening-a-url)                          |
| Pre-installed Custom Sound                                                    | These are the sounds that are pre-installed with the companion app.                                                                                                                                                                                                                                      | [link](https://companion.home-assistant.io/docs/notifications/notification-sounds#custom-push-notification-sounds)        |
| Custom Sound (Optional - will override pre-installed selection)               | Please see the companion documentation.                                                                                                                                                                                                                                                                  | [link](https://companion.home-assistant.io/docs/notifications/notification-sounds#custom-push-notification-sounds)        |
| Critical Notification?                                                        | iOS gives special priority to this type of notification. Critical alerts always appear at the top of your lock screen above all other notifications, and play a sound even if Do Not Disturb is enabled or the iPhone is muted.                                                                          | [link](https://companion.home-assistant.io/docs/notifications/critical-notifications/)                                    |
| Populate User Information                                                     | Will resolve user info in Node-RED and place it in `msg.userData`                                                                                                                                                                                                                                        |                                                                                                                   |
| Clear notifications on Action Received?                                       | Will clear all notifications related to this if an action is recieved from any of the devices notified.                                                                                                                                                                                                  | [link](https://companion.home-assistant.io/docs/notifications/notifications-basic#clearing)                               |
| Action [x] Title                                                              | iOS notifications can have ufrom ZERO to 4 actions. If you do not populate any of the action titles, the notification sent will just be a non-actionable notification. This is the title that is displayed on the action button.                                                                                                                                                                                                    | [link](https://companion.home-assistant.io/docs/notifications/actionable-notifications#building-actionable-notifications) |
| Action [x] URL (optional)                                                     | Optional. The URL to open when tapped                                                                                                                                                                                                                                                                    |                                                                                                                   |
| Action [x] Activation Mode                                                    | Set to foreground to launch the app when tapped. Defaults to background which just fires the event. This is automatically set to foreground when providing a uri.                                                                                                                                        | [link](https://companion.home-assistant.io/docs/notifications/actionable-notifications#ios-specific-options)              |
| Action [x] App Authentication Required?                                       | true to require entering a passcode to use the action.                                                                                                                                                                                                                                                   | [link](https://companion.home-assistant.io/docs/notifications/actionable-notifications#ios-specific-options)              |
| Action [x] Destructive?                                                       | true to color the action's title red, indicating a destructive action.                                                                                                                                                                                                                                   | [link](https://companion.home-assistant.io/docs/notifications/actionable-notifications#ios-specific-options)              |
| Action [x] Behavior                                                           | textInput to prompt for text to return with the event. This also occurs when setting the action to REPLY.                                                                                                                                                                                                | [link](https://companion.home-assistant.io/docs/notifications/actionable-notifications#ios-specific-options)              |
| Action [x] Text Input Button Title (Required if behavior is Text Input)       | Title to use for text input for actions that prompt.                                                                                                                                                                                                                                                     | [link](https://companion.home-assistant.io/docs/notifications/actionable-notifications#ios-specific-options)              |
| Action [x] Text Input Placeholder (Optional - only if behavior is Text Input) | Placeholder to use for text input for actions that prompt.                                                                                                                                                                                                                                               | [link](https://companion.home-assistant.io/docs/notifications/actionable-notifications#ios-specific-options)              |
| Latitude for Pin 1                                                            | Will show a centered map with a red pin at the given coordinates.                                                                                                                                                                                                                                        | [link](https://companion.home-assistant.io/docs/notifications/dynamic-content#map)                                        |
| Longitude for Pin 1                                                           | Will show a centered map with a red pin at the given coordinates.                                                                                                                                                                                                                                        | [link](https://companion.home-assistant.io/docs/notifications/dynamic-content#map)                                        |
| Latitude for Pin 2                                                            | The latitude of the second pin.                                                                                                                                                                                                                                                                          | [link](https://companion.home-assistant.io/docs/notifications/dynamic-content#showing-a-second-pin)                       |
| Longitude for Pin 2                                                           | The longitude of the second pin.                                                                                                                                                                                                                                                                         | [link](https://companion.home-assistant.io/docs/notifications/dynamic-content#showing-a-second-pin)                       |
| Show a line between points?                                                   | Displays a line connecting the first and second pin.                                                                                                                                                                                                                                                     | [link](https://companion.home-assistant.io/docs/notifications/dynamic-content#showing-a-second-pin)                       |
| Show a compass on the map?                                                    | Displays a compass control on the map.                                                                                                                                                                                                                                                                   | [link](https://companion.home-assistant.io/docs/notifications/dynamic-content#extra-configuration)                        |
| Show points of interest?                                                      | Displays point-of-interest (POI) information on the map.                                                                                                                                                                                                                                                 | [link](https://companion.home-assistant.io/docs/notifications/dynamic-content#extra-configuration)                        |
| Show scale information on the map?                                            | Shows scale information on the map.                                                                                                                                                                                                                                                                      | [link](https://companion.home-assistant.io/docs/notifications/dynamic-content#extra-configuration)                        |
| Show Traffic?                                                                 | Displays traffic information on the map.                                                                                                                                                                                                                                                                 | [link](https://companion.home-assistant.io/docs/notifications/dynamic-content#extra-configuration)                        |
| Show User Location?                                                           | Attempts to display user's location on the map.                                                                                                                                                                                                                                                          | [link](https://companion.home-assistant.io/docs/notifications/dynamic-content#extra-configuration)                        |
| Camera Entity                                                                 | The preview thumbnail of the notification will display a still image from the camera. When expanded, the notification content displays a real time MJPEG stream if the camera supports it.                                                                                                               | [link](https://companion.home-assistant.io/docs/notifications/dynamic-content#camera-stream)                              |
| Image Path (10MB limit)                                                       | An attachment is an image, video, or audio file which is downloaded to the device when a notification is received and shown alongside the notification. A thumbnail is shown when the notification is not expanded. The full size attachment is shown when the notification is expanded.                 | [link](https://companion.home-assistant.io/docs/notifications/notification-attachments/#parameters)                       |
| Video Path (50MB limit)                                                       |                                                                                                                                                                                                                                                                                                          | [link](https://companion.home-assistant.io/docs/notifications/notification-attachments/#parameters)                       |
| Audio Path (5MB limit)                                                        |                                                                                                                                                                                                                                                                                                          | [link](https://companion.home-assistant.io/docs/notifications/notification-attachments/#parameters)                       |
| Content URL (overrides image/video/audio)                                     | Optional. The URL of content to use as the attachment. This URL must be accessible from the Internet, or the receiving device must be on the same network as the hosted content. This overrides any image, video or audio values.                                                                        | [link](https://companion.home-assistant.io/docs/notifications/notification-attachments/#configuration)                    |
| Load Media in Notification Lazily?                                            | Optional.If set to true the attachment will not be downloaded immediately and will only be loaded when viewing the notification. Use this to avoid downloading obviously-too-large attachments, but if they are only occasionally too large, you shouldn't provide this key as the app can attempt both. | [link](https://companion.home-assistant.io/docs/notifications/notification-attachments/#configuration)                    |
| Hide thumbnail?                                                               | Optional. If set to true the thumbnail will not show on the notification. The content will only be viewable by expanding.                                                                                                                                                                                | [link](https://companion.home-assistant.io/docs/notifications/notification-attachments/#configuration)                    | 


You may override the data that is set in the subflow node. If you create a message object with the following structure (note, any of these are optional):
```
msg.notificationOverride.title = "dynamic title!";
msg.notificationOverride.subtitle = "dynamic subtitle";
msg.notificationOverride.message = "Some new message like Battery is at " + msg.payload.attributes.battery + "%";
msg.notificationOverride.url = "/hacs";
msg.notificationOverride.services = "my_phone, partners_phone, kids_phone"; //could override this depending on who is "home".
msg.notificationOverride.cameraEntity = "camera.my_back_yard";
msg.notificationOverride.tag = "xyzTag" // could be that you want to send the same message, but have it appear multiple times on the device rather than overwritten.
msg.notificationOverride.clear = true; // will attempt to clear all messages to all specified devices in the setup or in msg.notificationOverride.services if overridden. I believe this currently isn't working because apple isn't allowing them to do this with the app. But they've petitioned for it... 
```
and push it into the input of the node, it'll override any settings you have set at are above.

